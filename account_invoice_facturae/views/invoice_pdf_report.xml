<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <report id="account_invoices_facturae"
            model="account.invoice"
            string="Factura Electronica"
            report_type="qweb-pdf"
            name="account.report_invoice_facturae"
            file="account.report_invoice_facturae" />
    </data>

    <template id="account.report_invoice_facturae_header" inherit_id="report.external_layout_header"> <!--  primary="True" -->
        <xpath expr="//div[@class='header']" position="replace">
            <div class="header">
                <div class="row uppercase" style="font-size: 12px;">
                    <div class="col-xs-4">
                        <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="max-height: 95px;"/>
                    </div>
                    <div class="col-xs-8" name="company_address">
                        <!-- <div t-field="company.partner_id" t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;vat&quot;,&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: true}" style="border-bottom: 1px solid #457DA3;"/> -->
                        <p style="margin: 0 0 2px;">
                            <b>RFC: 
                                <span t-esc="company.vat[2:]"></span>, 
                                <span t-field="company.name"></span>
                            </b>
                        </p>
                        <p style="margin: 0 0 2px;">
                            <span t-field="company.street"></span> 
                            <span t-field="company.l10n_mx_street3"></span> 
                            <span t-field="company.l10n_mx_street4"></span>, 
                            COL: <span t-field="company.street2"></span>, 
                            <span t-field="company.city"></span>, 
                            <span t-field="company.state_id"></span>, 
                            <span t-field="company.country_id"></span>, 
                            CP: <span t-field="company.zip"></span>, 
                            EMAIL: <span t-field="company.email"></span>
                        </p>
                        <!-- <p style="margin: 0 0 2px;">
                            CP: <span t-field="company.zip"></span>, 
                            EMAIL: <span t-field="company.email"></span>
                        </p> -->

                        <p style="margin: 0 0 2px;">
                            REGIMEN FISCAL: <span  t-field="company.partner_id.regimen_fiscal_id"></span>
                        </p>
                        <p style="margin: 0 0 2px;">
                            LUGAR DE EXPEDICION: <span  t-field="company.city"></span>
                        </p>
                        
                    </div>                   
                </div>
                <hr/>
            </div>
        </xpath>
    </template>

    <template id="account.report_invoice_facturae">
        <t t-call="report.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="report.external_layout">
                    <div class="page" style="font-size: 12px;">
                        <div class="row">
                            <div class="col-xs-6">
                                <h5><b><span t-field="o.partner_id"/></b></h5>
                                <p style="margin: 0 0 2px;"><b>RFC: <span t-field="o.partner_id.vat" /></b></p>
                                <p style="margin: 0 0 2px;"> <span t-field="o.partner_id.street"/> <span t-field="o.partner_id.l10n_mx_street3"/> <span t-field="o.partner_id.l10n_mx_street4"/>, COL: <span t-field="o.partner_id.street2"/></p>
                                <p style="margin: 0 0 2px;"> <span t-field="o.partner_id.city"/>, <span t-field="o.partner_id.state_id"/>, <span t-field="o.partner_id.country_id"/></p>
                            </div>
                            <div class="col-xs-6" >
                                <p style="margin: 0 0 2px;">
                                    Serie-Folio: <strong><span  t-field="o.number"></span></strong>
                                </p>
                                 <p style="margin: 0 0 2px;">
                                    Efecto CFDI: <strong><span>INGRESO</span></strong>
                                </p>
                                 <p style="margin: 0 0 2px;">
                                    No. Certificado CSD: <strong><span t-field="o.factura_nocertificado"></span></strong>
                                </p>
                                 <p style="margin: 0 0 2px;">
                                    Tipo Comprobante: <strong><span>FACTURA</span></strong>
                                </p>
                                <p style="margin: 0 0 2px;">
                                    Fecha-Hora Emision: <strong><span t-field="o.factura_fecemi"></span></strong>
                                </p>
                            </div>


                            <br/>
                        </div>

                        <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>
                        <!-- partidas -->
                        <table class="table table-condensed">
                            <thead>
                                <tr>
                                    <th>Descripcion</th>
                                    <th>Unidad de medida</th>
                                    <th class="text-right">Cantidad</th>
                                    <th class="text-right">Precio Unitario</th>
                                    <th class="text-right">Importe</th>
                                </tr>
                            </thead>
                            <tbody class="invoice_tbody">
                                <tr t-foreach="o.invoice_line_ids" t-as="l">
                                    <td><span t-field="l.name"/></td>
                                    <td class="text-right">
                                        <span t-field="l.quantity"/>
                                        <span t-field="l.uom_id"  groups="product.group_uom"/>
                                    </td>
                                    <td><span t-field="l.uom_id.name"/></td>
                                    <td class="text-right">
                                        <span t-field="l.price_unit"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="l.price_total" 
                                            t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                    </td>
                                </tr>
                                
                            </tbody>
                        </table>
                        <!-- end partidas -->
                        <!-- Totales -->
                        <div class="row">
                            
                            <div class="col-xs-4 pull-right">
                                <table class="table table-condensed">
                                    <tr class="border-black">
                                        <td><strong>Subtotal</strong></td>
                                        <td class="text-right">
                                            <strong><span t-field="o.amount_untaxed" t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/></strong>
                                        </td>
                                    </tr>
                                    <t t-foreach="o._get_tax_amount_by_group()" t-as="amount_by_group">
                                        <tr>
                                            <td><strong>IVA 16.00%</strong></td>
                                            <td class="text-right">
                                                <strong><span t-esc="amount_by_group[1]"/></strong>
                                            </td>
                                        </tr>
                                    </t>
                                    <tr class="border-black">
                                        <td><strong>Total</strong></td>
                                        <td class="text-right">
                                             <strong><span t-field="o.amount_total" t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/></strong>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="row ">
                            <strong>Total en letra: <span t-field="o.amount_to_text"/></strong>
                        </div>
                        <!-- end totales -->
                        <!-- Totales en letra -->
                        <!-- <div class="row ">
                            <div class="col-xs-12">
                                <table class="table table-condensed" style="margin-bottom: 2px;">
                                    <tr class="border-black">
                                        <td style="border-bottom: white 2px solid;"><strong>Total Articulos</strong></td>
                                        <td class="" style="border-bottom: white 2px solid;">
                                            <strong><span>1</span></strong>
                                        </td>
                                        <td style="border-bottom: white 2px solid;"><strong>No. Conceptos</strong></td>
                                        <td class="" style="border-bottom: white 2px solid;">
                                            <strong><span>1</span></strong>
                                        </td>
                                    </tr>
                                    
                                    <tr >
                                        <td><strong>Total con letra</strong></td>
                                        <td class="text-right">
                                           
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div> -->
                        <!-- end totales en letra -->
                        <!-- Certificados -->
                        <div class="row ">

                            <div class="col-xs-12">
                                 <table class="table table-condensed">
                                    <tr class="border-black" style="border-bottom: white 2px solid;">
                                        <td><strong>CADENA ORIGINAL:</strong></td>
                                        
                                    </tr>
                                    <tr style="border-bottom: white 2px solid;">
                                        <td><p><span t-field="o.factura_cadena"></span></p></td>
                                       
                                    </tr>
                                    <tr style="border-bottom: white 2px solid;">
                                        <td><strong>SELLO DIGITAL DEL CFDI:</strong></td>
                                        
                                    </tr>
                                    <tr>
                                        <td><p><span t-field="o.factura_sello"></span></p></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <!-- end certificados -->
                        <!-- Metodos de pago -->
                        <div class="row ">
                            <div class="col-xs-12">
                                <table class="table table-condensed">
                                    <tr class="border-black" style="border-bottom: white 2px solid;">
                                        <td><strong>METODO DE PAGO:</strong></td>
                                        <td class="text-left">
                                            <span t-field="o.partner_id.pay_method_id.code"></span>
                                        </td>
                                        <td><strong>MONEDA:</strong></td>
                                        <td class="">
                                            <span t-field="o.factura_moneda"></span>
                                        </td>
                                    </tr>
                                    <tr style="border-bottom: white 2px solid;">
                                        <td><strong>NO.CTA.PAGO:</strong></td>
                                        <td class="text-left">
                                             <span t-field="o.partner_id.acc_payment"></span>
                                        </td>
                                        <td><strong>TIPO DE CAMBIO:</strong></td>
                                        <td class="text-left">
                                             <span ></span>
                                        </td>
                                    </tr>
                                    <tr style="border-bottom: white 2px solid;">
                                        <td><strong>CONDICIONES:</strong></td>
                                        <td class="text-left">
                                             <span ></span>
                                        </td>
                                        <td><strong>FORMA DE PAGO:</strong></td>
                                        <td class="text-left">
                                             <span t-field="o.factura_formapago"></span>
                                        </td>
                                    </tr>
                                </table>
                               
                            </div>
                        </div>
                        <!-- end metodos de pago -->
                        <!-- certificados del sat -->
                        <div class="row ">
                            <div class="col-xs-4">
                                <!--<img t-att-src="'/report/barcode/QR/%s' % "/>-->
                                <img t-att-src="'/report/barcode/?type=%s&value=%s&width=%s&height=%s' % ('QR', o.factura_qr_cadena, 50, 50)" style="width:50px;height:50px;"/>
                            </div>
                            <div class="col-xs-8">
                                
                                <hr style="border-top: 1px solid #333;"/>
                                <p><strong>TIMBRE FISCAL DIGITAL - COMPLEMENTO DE CERTIFICACION DEL SAT:</strong></p>
                                <p>
                                    <strong>VERSION:</strong>
                                </p>    
                                    
                                
                                <p>
                                    <strong>FOLIO FISCAL-UUID:</strong> <span t-field="o.factura_uuid"/>
                                </p>
                                    
                                <p>
                                    <strong>FECHA TIMBRADO: </strong><span t-field="o.factura_fecemi"/>
                                </p>
                                <p>
                                    <strong>NO. CERTIFICACION:</strong> <span t-field="o.factura_certificado"/>
                                </p>   
                                <p><strong>SELLO SAT:</strong> <span t-field="o.factura_sellosat"/></p>
                                <p><strong>CADENA ORIGINAL DEL TIMBRE FISCAL DIGITAL DEL SAT:</strong></p>
                            </div>
                        </div>
                        <!-- end certificados del sat -->

                    </div>

                </t>
            </t>
        </t>
    </template>
    <template id="account.report_invoice_facturae_footer" inherit_id="report.external_layout_footer">
        <xpath expr="//div[@class='footer']" position="replace">
            <div class="footer">
                <div class="text-center" style="border-top: 1px solid black; font-size: 10px;">
                    <ul t-if="not company.custom_footer" class="list-inline">
                        <li>ESTE DOCUMENTO ES UNA REPRESENTACION IMPRESA DE UN CFDI</li>
                    </ul>

                    <ul t-if="not company.custom_footer" class="list-inline" name="financial_infos">
                       
                    </ul>

                    <t t-if="company.custom_footer">
                       
                    </t>

                    <ul class="list-inline">
                        <li>Page:</li>
                        <li><span class="page"/></li>
                        <li>/</li>
                        <li><span class="topage"/></li>
                    </ul>
                    
                </div>
            </div>
                 
        </xpath>
    </template>


<!-- 
    <?xml version="1.0"?>
    <t t-name="report.external_layout_header">
        <div class="header">
            <div class="row">
                <div class="col-xs-3">
                    <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="max-height: 45px;"/>
                </div>
                <div class="col-xs-9 text-right" style="margin-top:20px;" t-field="company.rml_header1"/>
            </div>
            <div class="row zero_min_height">
                <div class="col-xs-12">
                    <div style="border-bottom: 1px solid #457DA3;"/>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12" name="company_address">
                    <div t-field="company.partner_id" t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: true}" style="border-bottom: 1px solid #457DA3;"/>
                </div>
            </div>
        </div>
    </t> -->
</openerp>

<!-- 
file="account.report_invoice_facturae"
attachment_use="True"
attachment="(object.state in ('open','paid')) and
    ('INV'+(object.number or '').replace('/','')+'.pdf')"
 -->